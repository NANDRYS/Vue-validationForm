/*! maska v3.0.0 by Alexander Shabunevich | Released under the MIT license */
(function(u,p){typeof exports=="object"&&typeof module<"u"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(u=typeof globalThis<"u"?globalThis:u||self,p(u.Maska={}))})(this,function(u){"use strict";var j=Object.defineProperty;var V=(u,p,M)=>p in u?j(u,p,{enumerable:!0,configurable:!0,writable:!0,value:M}):u[p]=M;var v=(u,p,M)=>V(u,typeof p!="symbol"?p+"":p,M);const p={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}},M=(a,s,e)=>a.replaceAll(s,"").replace(e,".").replace("..",".").replace(/[^.\d]/g,""),P=(a,s,e)=>{var t;return new Intl.NumberFormat(((t=e.number)==null?void 0:t.locale)??"en",{minimumFractionDigits:a,maximumFractionDigits:s,roundingMode:"trunc"})},L=(a,s=!0,e)=>{var b,N,A,g;const t=((b=e.number)==null?void 0:b.unsigned)==null&&a.startsWith("-")?"-":"",n=((N=e.number)==null?void 0:N.fraction)??0;let o=P(0,n,e);const h=o.formatToParts(1000.12),m=((A=h.find(i=>i.type==="group"))==null?void 0:A.value)??" ",l=((g=h.find(i=>i.type==="decimal"))==null?void 0:g.value)??".",r=M(a,m,l);if(r===""||Number.isNaN(r))return t;const f=r.split(".");if(f[1]!=null&&f[1].length>=1){const i=f[1].length<=n?f[1].length:n;o=P(i,n,e)}let c=o.format(parseFloat(r));return s?n>0&&r.endsWith(".")&&!r.slice(0,-1).includes(".")&&(c+=l):c=M(c,m,l),t+c};class T{constructor(s={}){v(this,"opts",{});v(this,"memo",new Map);const e={...s};if(e.tokens!=null){e.tokens=e.tokensReplace?{...e.tokens}:{...p,...e.tokens};for(const t of Object.values(e.tokens))typeof t.pattern=="string"&&(t.pattern=new RegExp(t.pattern))}else e.tokens=p;Array.isArray(e.mask)&&(e.mask.length>1?e.mask=[...e.mask].sort((t,n)=>t.length-n.length):e.mask=e.mask[0]??""),e.mask===""&&(e.mask=null),this.opts=e}masked(s){return this.process(s,this.findMask(s))}unmasked(s){return this.process(s,this.findMask(s),!1)}isEager(){return this.opts.eager===!0}isReversed(){return this.opts.reversed===!0}completed(s){const e=this.findMask(s);if(this.opts.mask==null||e==null)return!1;const t=this.process(s,e).length;return typeof this.opts.mask=="string"?t>=this.opts.mask.length:t>=e.length}findMask(s){const e=this.opts.mask;if(e==null)return null;if(typeof e=="string")return e;if(typeof e=="function")return e(s);const t=this.process(s,e.slice(-1).pop()??"",!1);return e.find(n=>this.process(s,n,!1).length>=t.length)??""}escapeMask(s){const e=[],t=[];return s.split("").forEach((n,o)=>{n==="!"&&s[o-1]!=="!"?t.push(o-t.length):e.push(n)}),{mask:e.join(""),escaped:t}}process(s,e,t=!0){if(this.opts.number!=null)return L(s,t,this.opts);if(e==null)return s;const n=`v=${s},mr=${e},m=${t?1:0}`;if(this.memo.has(n))return this.memo.get(n);const{mask:o,escaped:h}=this.escapeMask(e),m=[],l=this.opts.tokens!=null?this.opts.tokens:{},r=this.isReversed()?-1:1,f=this.isReversed()?"unshift":"push",c=this.isReversed()?0:o.length-1,b=this.isReversed()?()=>i>-1&&d>-1:()=>i<o.length&&d<s.length,N=y=>!this.isReversed()&&y<=c||this.isReversed()&&y>=c;let A,g=-1,i=this.isReversed()?o.length-1:0,d=this.isReversed()?s.length-1:0,R=!1;for(;b();){const y=o.charAt(i),k=l[y],w=(k==null?void 0:k.transform)!=null?k.transform(s.charAt(d)):s.charAt(d);if(!h.includes(i)&&k!=null?(w.match(k.pattern)!=null?(m[f](w),k.repeated?(g===-1?g=i:i===c&&i!==g&&(i=g-r),c===g&&(i-=r)):k.multiple&&(R=!0,i-=r),i+=r):k.multiple?R&&(i+=r,d-=r,R=!1):w===A?A=void 0:k.optional&&(i+=r,d-=r),d+=r):(t&&!this.isEager()&&m[f](y),w===y&&!this.isEager()?d+=r:A=y,this.isEager()||(i+=r)),this.isEager())for(;N(i)&&(l[o.charAt(i)]==null||h.includes(i));){if(t){if(m[f](o.charAt(i)),s.charAt(d)===o.charAt(i)){i+=r,d+=r;continue}}else o.charAt(i)===s.charAt(d)&&(d+=r);i+=r}}return this.memo.set(n,m.join("")),this.memo.get(n)}}const C=a=>JSON.parse(a.replaceAll("'",'"')),W=(a,s={})=>{const e={...s};a.dataset.maska!=null&&a.dataset.maska!==""&&(e.mask=x(a.dataset.maska)),a.dataset.maskaEager!=null&&(e.eager=E(a.dataset.maskaEager)),a.dataset.maskaReversed!=null&&(e.reversed=E(a.dataset.maskaReversed)),a.dataset.maskaTokensReplace!=null&&(e.tokensReplace=E(a.dataset.maskaTokensReplace)),a.dataset.maskaTokens!=null&&(e.tokens=O(a.dataset.maskaTokens));const t={};return a.dataset.maskaNumberLocale!=null&&(t.locale=a.dataset.maskaNumberLocale),a.dataset.maskaNumberFraction!=null&&(t.fraction=parseInt(a.dataset.maskaNumberFraction)),a.dataset.maskaNumberUnsigned!=null&&(t.unsigned=E(a.dataset.maskaNumberUnsigned)),(a.dataset.maskaNumber!=null||Object.values(t).length>0)&&(e.number=t),e},E=a=>a!==""?!!JSON.parse(a):!0,x=a=>a.startsWith("[")&&a.endsWith("]")?C(a):a,O=a=>{if(a.startsWith("{")&&a.endsWith("}"))return C(a);const s={};return a.split("|").forEach(e=>{const t=e.split(":");s[t[0]]={pattern:new RegExp(t[1]),optional:t[2]==="optional",multiple:t[2]==="multiple",repeated:t[2]==="repeated"}}),s};class S{constructor(s,e={}){v(this,"items",new Map);v(this,"onInput",s=>{if(s instanceof CustomEvent&&s.type==="input")return;const e=s.target,t=this.items.get(e),n="inputType"in s&&s.inputType.startsWith("delete"),o=t.isEager(),h=n&&o&&t.unmasked(e.value)===""?"":e.value;this.fixCursor(e,n,()=>this.setValue(e,h))});this.options=e,this.init(this.getInputs(s))}update(s={}){this.options={...s},this.init(Array.from(this.items.keys()))}updateValue(s){s.value!==""&&s.value!==this.processInput(s).masked&&this.setValue(s,s.value)}destroy(){for(const s of this.items.keys())s.removeEventListener("input",this.onInput);this.items.clear()}init(s){const e=this.getOptions(this.options);for(const t of s){this.items.has(t)||t.addEventListener("input",this.onInput,{capture:!0});const n=new T(W(t,e));this.items.set(t,n),queueMicrotask(()=>this.updateValue(t)),t.selectionStart===null&&n.isEager()&&console.warn("Maska: input of `%s` type is not supported",t.type)}}getInputs(s){return typeof s=="string"?Array.from(document.querySelectorAll(s)):"length"in s?Array.from(s):[s]}getOptions(s){const{onMaska:e,preProcess:t,postProcess:n,...o}=s;return o}fixCursor(s,e,t){const n=s.selectionStart,o=s.value;if(t(),n===null||n===o.length&&!e)return;const h=s.value,m=o.slice(0,n),l=h.slice(0,n),r=this.processInput(s,m).unmasked,f=this.processInput(s,l).unmasked;let c=n;m!==l&&(c+=e?h.length-o.length:r.length-f.length),s.setSelectionRange(c,c)}setValue(s,e){const t=this.processInput(s,e);s.value=t.masked,this.options.onMaska!=null&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach(n=>n(t)):this.options.onMaska(t)),s.dispatchEvent(new CustomEvent("maska",{detail:t})),s.dispatchEvent(new CustomEvent("input",{detail:t.masked}))}processInput(s,e){const t=this.items.get(s);let n=e??s.value;this.options.preProcess!=null&&(n=this.options.preProcess(n));let o=t.masked(n);return this.options.postProcess!=null&&(o=this.options.postProcess(o)),{masked:o,unmasked:t.unmasked(n),completed:t.completed(n)}}}const I=new WeakMap,F=a=>{a.directive("maska",(s,e,t)=>{const n=s instanceof HTMLInputElement?s:s.querySelector("input");if(n==null||(n==null?void 0:n.type)==="file")return;let o={};const h=e.expression!==""?t.evaluateLater(e.expression):()=>{};t.effect(()=>{var m;if(h(l=>{o=typeof l=="string"?{mask:l}:{...l}}),e.value!=null){const l=r=>{const f=e.modifiers.includes("unmasked")?r.unmasked:e.modifiers.includes("completed")?r.completed:r.masked,c=t.Alpine.$data(n);e.value in c&&(c[e.value]=f)};o.onMaska=o.onMaska==null?l:Array.isArray(o.onMaska)?[...o.onMaska,l]:[o.onMaska,l]}I.has(n)?(m=I.get(n))==null||m.update(o):I.set(n,new S(n,o))})}).before("model")};document.addEventListener("alpine:init",()=>{window.Alpine.plugin(F)}),u.Mask=T,u.MaskInput=S,u.tokens=p,u.xMaska=F,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
