/*! maska v3.0.0 by Alexander Shabunevich | Released under the MIT license */
(function(l,c){typeof exports=="object"&&typeof module<"u"?c(exports):typeof define=="function"&&define.amd?define(["exports"],c):(l=typeof globalThis<"u"?globalThis:l||self,c(l.Maska={}))})(this,function(l){"use strict";var V=Object.defineProperty;var $=(l,c,M)=>c in l?V(l,c,{enumerable:!0,configurable:!0,writable:!0,value:M}):l[c]=M;var A=(l,c,M)=>$(l,typeof c!="symbol"?c+"":c,M);const c={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}},M=(a,e,s)=>a.replaceAll(e,"").replace(s,".").replace("..",".").replace(/[^.\d]/g,""),T=(a,e,s)=>{var t;return new Intl.NumberFormat(((t=s.number)==null?void 0:t.locale)??"en",{minimumFractionDigits:a,maximumFractionDigits:e,roundingMode:"trunc"})},W=(a,e=!0,s)=>{var N,w,v,g;const t=((N=s.number)==null?void 0:N.unsigned)==null&&a.startsWith("-")?"-":"",n=((w=s.number)==null?void 0:w.fraction)??0;let o=T(0,n,s);const u=o.formatToParts(1000.12),h=((v=u.find(r=>r.type==="group"))==null?void 0:v.value)??" ",d=((g=u.find(r=>r.type==="decimal"))==null?void 0:g.value)??".",i=M(a,h,d);if(i===""||Number.isNaN(i))return t;const f=i.split(".");if(f[1]!=null&&f[1].length>=1){const r=f[1].length<=n?f[1].length:n;o=T(r,n,s)}let p=o.format(parseFloat(i));return e?n>0&&i.endsWith(".")&&!i.slice(0,-1).includes(".")&&(p+=d):p=M(p,h,d),t+p};class C{constructor(e={}){A(this,"opts",{});A(this,"memo",new Map);const s={...e};if(s.tokens!=null){s.tokens=s.tokensReplace?{...s.tokens}:{...c,...s.tokens};for(const t of Object.values(s.tokens))typeof t.pattern=="string"&&(t.pattern=new RegExp(t.pattern))}else s.tokens=c;Array.isArray(s.mask)&&(s.mask.length>1?s.mask=[...s.mask].sort((t,n)=>t.length-n.length):s.mask=s.mask[0]??""),s.mask===""&&(s.mask=null),this.opts=s}masked(e){return this.process(e,this.findMask(e))}unmasked(e){return this.process(e,this.findMask(e),!1)}isEager(){return this.opts.eager===!0}isReversed(){return this.opts.reversed===!0}completed(e){const s=this.findMask(e);if(this.opts.mask==null||s==null)return!1;const t=this.process(e,s).length;return typeof this.opts.mask=="string"?t>=this.opts.mask.length:t>=s.length}findMask(e){const s=this.opts.mask;if(s==null)return null;if(typeof s=="string")return s;if(typeof s=="function")return s(e);const t=this.process(e,s.slice(-1).pop()??"",!1);return s.find(n=>this.process(e,n,!1).length>=t.length)??""}escapeMask(e){const s=[],t=[];return e.split("").forEach((n,o)=>{n==="!"&&e[o-1]!=="!"?t.push(o-t.length):s.push(n)}),{mask:s.join(""),escaped:t}}process(e,s,t=!0){if(this.opts.number!=null)return W(e,t,this.opts);if(s==null)return e;const n=`v=${e},mr=${s},m=${t?1:0}`;if(this.memo.has(n))return this.memo.get(n);const{mask:o,escaped:u}=this.escapeMask(s),h=[],d=this.opts.tokens!=null?this.opts.tokens:{},i=this.isReversed()?-1:1,f=this.isReversed()?"unshift":"push",p=this.isReversed()?0:o.length-1,N=this.isReversed()?()=>r>-1&&m>-1:()=>r<o.length&&m<e.length,w=y=>!this.isReversed()&&y<=p||this.isReversed()&&y>=p;let v,g=-1,r=this.isReversed()?o.length-1:0,m=this.isReversed()?e.length-1:0,P=!1;for(;N();){const y=o.charAt(r),k=d[y],I=(k==null?void 0:k.transform)!=null?k.transform(e.charAt(m)):e.charAt(m);if(!u.includes(r)&&k!=null?(I.match(k.pattern)!=null?(h[f](I),k.repeated?(g===-1?g=r:r===p&&r!==g&&(r=g-i),p===g&&(r-=i)):k.multiple&&(P=!0,r-=i),r+=i):k.multiple?P&&(r+=i,m-=i,P=!1):I===v?v=void 0:k.optional&&(r+=i,m-=i),m+=i):(t&&!this.isEager()&&h[f](y),I===y&&!this.isEager()?m+=i:v=y,this.isEager()||(r+=i)),this.isEager())for(;w(r)&&(d[o.charAt(r)]==null||u.includes(r));){if(t){if(h[f](o.charAt(r)),e.charAt(m)===o.charAt(r)){r+=i,m+=i;continue}}else o.charAt(r)===e.charAt(m)&&(m+=i);r+=i}}return this.memo.set(n,h.join("")),this.memo.get(n)}}const S=a=>JSON.parse(a.replaceAll("'",'"')),b=(a,e={})=>{const s={...e};a.dataset.maska!=null&&a.dataset.maska!==""&&(s.mask=x(a.dataset.maska)),a.dataset.maskaEager!=null&&(s.eager=E(a.dataset.maskaEager)),a.dataset.maskaReversed!=null&&(s.reversed=E(a.dataset.maskaReversed)),a.dataset.maskaTokensReplace!=null&&(s.tokensReplace=E(a.dataset.maskaTokensReplace)),a.dataset.maskaTokens!=null&&(s.tokens=O(a.dataset.maskaTokens));const t={};return a.dataset.maskaNumberLocale!=null&&(t.locale=a.dataset.maskaNumberLocale),a.dataset.maskaNumberFraction!=null&&(t.fraction=parseInt(a.dataset.maskaNumberFraction)),a.dataset.maskaNumberUnsigned!=null&&(t.unsigned=E(a.dataset.maskaNumberUnsigned)),(a.dataset.maskaNumber!=null||Object.values(t).length>0)&&(s.number=t),s},E=a=>a!==""?!!JSON.parse(a):!0,x=a=>a.startsWith("[")&&a.endsWith("]")?S(a):a,O=a=>{if(a.startsWith("{")&&a.endsWith("}"))return S(a);const e={};return a.split("|").forEach(s=>{const t=s.split(":");e[t[0]]={pattern:new RegExp(t[1]),optional:t[2]==="optional",multiple:t[2]==="multiple",repeated:t[2]==="repeated"}}),e};class F{constructor(e,s={}){A(this,"items",new Map);A(this,"onInput",e=>{if(e instanceof CustomEvent&&e.type==="input")return;const s=e.target,t=this.items.get(s),n="inputType"in e&&e.inputType.startsWith("delete"),o=t.isEager(),u=n&&o&&t.unmasked(s.value)===""?"":s.value;this.fixCursor(s,n,()=>this.setValue(s,u))});this.options=s,this.init(this.getInputs(e))}update(e={}){this.options={...e},this.init(Array.from(this.items.keys()))}updateValue(e){e.value!==""&&e.value!==this.processInput(e).masked&&this.setValue(e,e.value)}destroy(){for(const e of this.items.keys())e.removeEventListener("input",this.onInput);this.items.clear()}init(e){const s=this.getOptions(this.options);for(const t of e){this.items.has(t)||t.addEventListener("input",this.onInput,{capture:!0});const n=new C(b(t,s));this.items.set(t,n),queueMicrotask(()=>this.updateValue(t)),t.selectionStart===null&&n.isEager()&&console.warn("Maska: input of `%s` type is not supported",t.type)}}getInputs(e){return typeof e=="string"?Array.from(document.querySelectorAll(e)):"length"in e?Array.from(e):[e]}getOptions(e){const{onMaska:s,preProcess:t,postProcess:n,...o}=e;return o}fixCursor(e,s,t){const n=e.selectionStart,o=e.value;if(t(),n===null||n===o.length&&!s)return;const u=e.value,h=o.slice(0,n),d=u.slice(0,n),i=this.processInput(e,h).unmasked,f=this.processInput(e,d).unmasked;let p=n;h!==d&&(p+=s?u.length-o.length:i.length-f.length),e.setSelectionRange(p,p)}setValue(e,s){const t=this.processInput(e,s);e.value=t.masked,this.options.onMaska!=null&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach(n=>n(t)):this.options.onMaska(t)),e.dispatchEvent(new CustomEvent("maska",{detail:t})),e.dispatchEvent(new CustomEvent("input",{detail:t.masked}))}processInput(e,s){const t=this.items.get(e);let n=s??e.value;this.options.preProcess!=null&&(n=this.options.preProcess(n));let o=t.masked(n);return this.options.postProcess!=null&&(o=this.options.postProcess(o)),{masked:o,unmasked:t.unmasked(n),completed:t.completed(n)}}}const R=new WeakMap,j=(a,e)=>{if(a.arg==null||a.instance==null)return;const s="setup"in a.instance.$.type;a.arg in a.instance?a.instance[a.arg]=e:s&&console.warn("Maska: please expose `%s` using defineExpose",a.arg)},L=(a,e)=>{var n;const s=a instanceof HTMLInputElement?a:a.querySelector("input");if(s==null||(s==null?void 0:s.type)==="file")return;let t={};if(e.value!=null&&(t=typeof e.value=="string"?{mask:e.value}:{...e.value}),e.arg!=null){const o=u=>{const h=e.modifiers.unmasked?u.unmasked:e.modifiers.completed?u.completed:u.masked;j(e,h)};t.onMaska=t.onMaska==null?o:Array.isArray(t.onMaska)?[...t.onMaska,o]:[t.onMaska,o]}R.has(s)?(n=R.get(s))==null||n.update(t):R.set(s,new F(s,t))};l.Mask=C,l.MaskInput=F,l.tokens=c,l.vMaska=L,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});
